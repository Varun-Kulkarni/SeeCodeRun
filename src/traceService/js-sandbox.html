<!-- 
 Order of Operation (March 26, 2016)
1) [ ] Generate Execution Trace from example code (Han)
2) [ ] Searchbox will be used to match user input in executiontrace (Dana)
3) [ ] Collect search resuts in an array. (Dana)
4) [ ] Present the results in a static table (actual UI) for the user. (Dana)
5) [ ] Make the table dynamic with the Combo box different number of columns (jQuery) (Han)
6) [ ] Integrate with Ace Editor (Dana and Han)
7) [ ] Integrate with Aurelia (Working with David)
-->
<template bindable="sandbox">
    <div id="sandBoxDiv" style="height: 1000px"></div>
</template>

<html>
    <head>
        <script src="jlinq/JSLINQ.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    </head>
    <body>
        <div id="page-wrapper">
        <h3> Search Section</h3>
        <div>
            Enter Search Term:
            <input type="textfield" id="searchTerm" placeholder="ex. expression"> 
            <select name="optionSelected" id="optionSelected">
              <option value="Any">Any</option>
              <option value="ID">ID</option>
              <option value="VariableDeclaration">Variable Declaration</option>
              <option value="SyntaxType">Syntax Type</option>
            </select>
        </div>
        <br/>
        <h3> Search Results:</h3>
        <pre id='searchResultDisplayArea'></pre>
    </div>
    <script>
    /* global jlinq */
        window.onload = function(){
            // var queryTerm = document.getElementById('searchTerm');
            // sample source code for playing with jlinq
            var source = [  {"ID":1, "var":"x", "type":"expression"},
                            {"ID":2, "var":"y", "type":"expression"},
                            {"ID":3, "var":"z", "type":"Literal"},
                            {"ID":4, "var":"z", "type":"Literal"},
                            {"ID":5, "var":"y", "type":"expression"}
                        ];
            function updateTable(query,cols){
                var displayArea = document.getElementById('searchResultDisplayArea');
                if(query.length==0){
                    displayArea.innerHTML = "No Results Found. Try a different Search Term with Filter Option.";
                    return;
                }
                // var allAssociatedKeys = "";
                var table =" ";
                var i,c, qData;
                table = "<table border='1'>";
                for(i=0;i<query.length;i++){
                    // for(var key in query[i]){
                    //     allAssociatedKeys+="key:"+key+"\n";
                    // }
                    // alert(allAssociatedKeys);
                    // generate the table
                    table += "<tr><td>" +  "Row No. " + "</td>" + "<td>"+  i + " " +"</td>" 
                    for(c=0;c<cols.length;c++){
                        if(cols[c]=="ID")
                            qData = ("id"+":"+query[i].ID);
                        else if(cols[c]=="VariableDeclaration")
                            qData = ("var"+":"+query[i].var);
                        else if(cols[c]=="SyntaxType")
                            qData = ("type"+":"+query[i].type);
                        table += "<td>" + qData + "</td>";
                    }
                    table+= "</tr>";
                }
                table += "</table><br/>";
                displayArea.innerHTML =  table;
                //displayArea.innerHTML = JSON.stringify(query2);                  
            }
            function JlinqQuery(searchTerm,filterSelection){
                var usingJlinq = JSLINQ(source);
                if(searchTerm==""){
                    return source;
                }
                if(filterSelection == "Any")
                {
                   var query = usingJlinq.Where(function(item){return (item.ID == searchTerm||item.var == searchTerm||item.type == searchTerm)}).ToArray();
                }
                else if(filterSelection == "ID")
                {
                    var query = usingJlinq.Where(function(item){return item.ID == searchTerm}).ToArray();
                }
                else if(filterSelection == "VariableDeclaration")
                {
                    var query = usingJlinq.Where(function(item){return item.var == searchTerm}).ToArray();
                }
                else if(filterSelection == "SyntaxType")
                {
                    var query = usingJlinq.Where(function(item){return item.type == searchTerm}).ToArray();
                }     
                return query;
            }
            $("#searchTerm").change(function(e){
                // returns an object array of the queried results
                var select = document.getElementById("optionSelected");
                var option = select.options[select.selectedIndex].value; 
                var query = JlinqQuery(this.value,option);
                if(option=="Any"){
                    var combo = ["ID","VariableDeclaration","SyntaxType"];
                    updateTable(query,combo);
                }
                else{
                    var combo = [option];
                    updateTable(query,combo);
                }
                // alert(query);
                // updateTable(query);
            });
            $("#optionSelected").change(function(e){
                // returns an object array of the queried results
                var term = document.getElementById("searchTerm").value;
                var query = JlinqQuery(term,this.value);
                if(this.value=="Any"){
                    var combo = ["ID","VariableDeclaration","SyntaxType"];
                    updateTable(query,combo);
                }
                else{
                    var combo = [this.value];
                    updateTable(query,combo);
                }
                // alert(query);
                // updateTable(query);
            });
        }
        </script>
    </body>
</html>